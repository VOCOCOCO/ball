<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Игра с падающими звездами</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            overflow: hidden;
        }

        canvas {
            display: block;
            background-color: #000;
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        // Инициализация WebApp
        window.Telegram.WebApp.ready();

        // Настройки игры
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let stars = [];
        let catcher = { x: canvas.width / 2, width: 100, height: 20 };
        let starsCaught = 0;
        let gameOver = false;

        // Звезда, которая будет падать
        function Star() {
            this.x = Math.random() * canvas.width;
            this.y = -10;  // Начальная позиция выше экрана
            this.size = 5 + Math.random() * 5;
            this.speed = 2 + Math.random() * 3;
        }

        // Отображаем звезды на экране
        function drawStar(star) {
            ctx.beginPath();
            ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
            ctx.fillStyle = 'yellow';
            ctx.fill();
        }

        // Функция для обновления игры
        function updateGame() {
            if (gameOver) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);  // Очистка экрана

            // Падающие звезды
            stars.forEach((star, index) => {
                star.y += star.speed;

                // Если звезда падает за экран
                if (star.y > canvas.height) {
                    stars.splice(index, 1);  // Удаляем ее из массива
                    stars.push(new Star());  // Создаем новую звезду
                }

                // Проверка на ловлю звезды
                if (
                    star.y + star.size > canvas.height - catcher.height &&
                    star.x > catcher.x &&
                    star.x < catcher.x + catcher.width
                ) {
                    starsCaught++;
                    stars.splice(index, 1);  // Удаляем пойманную звезду
                    stars.push(new Star());  // Добавляем новую
                }

                drawStar(star);
            });

            // Рисуем ловушку
            ctx.fillStyle = 'white';
            ctx.fillRect(catcher.x, canvas.height - catcher.height, catcher.width, catcher.height);

            // Проверка на окончание игры (по времени)
            if (performance.now() > gameStartTime + 20000) {  // Игра длится 20 секунд
                gameOver = true;
                endGame();
            }

            requestAnimationFrame(updateGame);
        }

        // Функция окончания игры
        function endGame() {
            // Отправляем данные в WebApp
            window.Telegram.WebApp.sendData(starsCaught.toString());

            // Закрываем Web App
            window.Telegram.WebApp.close();
        }

        // Обработчик нажатий на экран (для мобильных устройств)
        window.addEventListener('touchmove', function (event) {
            const touchX = event.touches[0].clientX;
            catcher.x = touchX - catcher.width / 2;  // Обновляем положение ловушки по движению пальца
        });

        // Инициализация игры
        let gameStartTime = performance.now();
        stars.push(new Star());
        updateGame();

    </script>
</body>
</html>

